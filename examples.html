
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>examples</title><meta name="generator" content="MATLAB 8.2"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2015-02-20"><meta name="DC.source" content="examples.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, tt, code { font-size:12px; }
pre { margin:0px 0px 20px; }
pre.error { color:red; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">ESPIRiT examples (based on work by Sana Vaziri)</a></li><li><a href="#5">Example 1: ESPIRiT reconstruction (R = 2x2)</a></li><li><a href="#15">Example 2: Reconstruction of undersampled data with small FOV.</a></li><li><a href="#18">Example 3: Compressed Sensing and Parallel Imaging</a></li><li><a href="#21">Example 4: Basic Tools</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> examples
</pre><h2>ESPIRiT examples (based on work by Sana Vaziri)<a name="2"></a></h2><p>To begin, add '$(TOOLBOX_PATH)/matlab' to the library path. The environment variable TOOLBOX_PATH needs to be set to the base directory of the reconstruction tools package.</p><pre class="codeinput"><span class="keyword">if</span> isempty(getenv(<span class="string">'TOOLBOX_PATH'</span>))
	error(<span class="string">'Environment variable TOOLBOX_PATH is not set.'</span>);
<span class="keyword">end</span>

addpath(strcat(getenv(<span class="string">'TOOLBOX_PATH'</span>), <span class="string">'/matlab'</span>));
</pre><p>The input and output datasets are each stored in a pair of files: one header (.hdr) and one raw data (.cfl). All the data files used in this demo are in the data folder. The readcfl and writecfl Matlab methods can be found in $(TOOLBOX_PATH)/matlab and can be used to view and process the data and reconstructed images in Matlab.</p><h2>Example 1: ESPIRiT reconstruction (R = 2x2)<a name="5"></a></h2><p>The example uses ESPIRiT to obtain the image from 2x2 undersampled data.</p><p>A visualization of k-space data and sampling and zero-filled reconstruction</p><pre class="codeinput"><span class="comment">% sqrt sum-of-squares of k-space</span>
und2x2 = readcfl(<span class="string">'data/und2x2'</span>);
ksp_rss = bart(<span class="string">'rss 8'</span>, und2x2);

<span class="comment">% zero-filled reconstruction sqrt-sum-of-squares</span>
zf_coils = bart(<span class="string">'fft -i 6'</span>, und2x2);
zf_rss = bart(<span class="string">'rss 8'</span>, zf_coils);

ksp_rss = squeeze(ksp_rss);
zf_coils = squeeze(zf_coils);
zf_rss = squeeze(zf_rss);

figure,subplot(1,2,1), imshow(abs(ksp_rss).^0.125, []); title(<span class="string">'k-space'</span>)
subplot(1,2,2), imshow(abs(zf_rss), []); title(<span class="string">'zero-filled recon'</span>)
</pre><img vspace="5" hspace="5" src="examples_01.png" alt=""> <p>Show singular values of the calibration matrix</p><pre class="codeinput">calmat = bart(<span class="string">'calmat -r 20 -k 6'</span>, und2x2);
[U SV VH] = bart(<span class="string">'svd'</span>, calmat);

figure, plot(SV);
title(<span class="string">'Singular Values of the Calibration Matrix'</span>);
</pre><img vspace="5" hspace="5" src="examples_02.png" alt=""> <p>ESPIRiT calibration (using a maximum calibration region of size 20)</p><pre class="codeinput">[calib emaps] = bart(<span class="string">'ecalib -r 20'</span>, und2x2);
</pre><pre class="codeoutput">Calibration region...  (size: 1x20x20, pos: 0x105x80)
Energy: 0.568 0.282 0.104 0.031 0.008 0.003 0.002 0.001
Build calibration matrix and SVD...
Eigen decomposition... (size: 288)
Using 56/288 kernels (19.44%, last SV: 0.031736).
Zeropad...
FFT (juggling)...
Calculate Gram matrix...
Resize...
Point-wise eigen-decomposition...
Crop maps... (0.80)
Fix phase...
Done.
</pre><p>Extraction of first set of maps (0-th subarray along dimension 4)</p><pre class="codeinput">sens = bart(<span class="string">'slice 4 0'</span>, calib);


sens_maps = squeeze(sens);

figure,
subplot(121), imshow3(abs(sens_maps), [],[2,4]);
title(<span class="string">'Magnitude ESPIRiT 1st Set of Maps'</span>)
subplot(122), imshow3(angle(sens_maps),[],[2,4])
title(<span class="string">'Phase ESPIRiT 1st Set of Maps'</span>)
</pre><img vspace="5" hspace="5" src="examples_03.png" alt=""> <p>For comparison: Produce coil images from fully-sampled data using the fft command. It uses a bitmask as argument to specify the dimensions which are transformed. Here, the bitmask is 6 = 2^1 + 2^2 which corresponds to the dimensions 1 and 2.</p><pre class="codeinput">full = readcfl(<span class="string">'data/full'</span>);
coilimgs = bart(<span class="string">'fft -i 6'</span>, full);

coil_imgs = squeeze(coilimgs);
figure, imshow3(abs(coil_imgs), [],[2,4])
title(<span class="string">'Coil images'</span>)
</pre><img vspace="5" hspace="5" src="examples_04.png" alt=""> <p>Show eigenvalue maps</p><pre class="codeinput">emaps = squeeze(emaps);
figure, imshow3(emaps, [], [1, 2]);
title(<span class="string">'First Two Eigenvalue Maps'</span>)
</pre><img vspace="5" hspace="5" src="examples_05.png" alt=""> <p>SENSE reconstruction using ESPIRiT maps</p><pre class="codeinput">reco = bart(<span class="string">'sense'</span>, und2x2, sens);

sense_recon = squeeze(reco);
figure, imshow(abs(sense_recon), []); title(<span class="string">'ESPIRiT Reconstruction'</span>)
</pre><pre class="codeoutput">Size: 41400 Samples: 10650 Acc: 3.89
Total Time: 0.594283
</pre><img vspace="5" hspace="5" src="examples_06.png" alt=""> <p>Evaluation of the coil sensitivities.</p><pre class="codeinput"><span class="comment">%</span>
<span class="comment">% Computing error from projecting fully sampled error</span>
<span class="comment">% onto the sensitivities. This can be done with one</span>
<span class="comment">% iteration of POCSENSE.</span>
<span class="comment">%</span>
proj = bart(<span class="string">'pocsense -r 0. -i 1'</span>, full, sens);

<span class="comment">% Compute error and transform it into image domain and combine into a single map.</span>
errimgs = bart(<span class="string">'fft -i 6'</span>, (full - proj));
errsos_espirit = bart(<span class="string">'rss 8'</span>, errimgs);

<span class="comment">%</span>
<span class="comment">% For comparison: compute sensitivities directly from the center.</span>
sens_direct = bart(<span class="string">'caldir 20'</span>, und2x2);

<span class="comment">% Compute error map.</span>
proj = bart(<span class="string">'pocsense -r 0. -i 1'</span>, full, sens_direct);
errimgs = bart(<span class="string">'fft -i 6'</span>, (full - proj));
errsos_direct = bart(<span class="string">'rss 8'</span>, errimgs);


errsos_espirit = squeeze(errsos_espirit);
errsos_direct = squeeze(errsos_direct);

figure,
imshow(abs([errsos_direct errsos_espirit]), []); title(<span class="string">'Projection Error (direct calibration vs ESPIRiT)'</span>);
</pre><pre class="codeoutput">Reconstruction...
Done
Done.
Calibration region 1x20x20
Done.
Reconstruction...
Done
Done.
</pre><img vspace="5" hspace="5" src="examples_07.png" alt=""> <h2>Example 2: Reconstruction of undersampled data with small FOV.<a name="15"></a></h2><p>This example uses a undersampled data set with a small FOV. The image reconstructed using ESPIRiT is compared to an image reconstructed with SENSE. By using two sets of maps, ESPIRiT can avoid the central artifact which appears in the SENSE reconstruction.</p><pre class="codeinput"><span class="comment">% Zero padding to make square voxels since resolution in x-y for this</span>
<span class="comment">% data set is lower in phase-encode than readout</span>
smallfov = readcfl(<span class="string">'data/smallfov'</span>);
smallfov = bart(<span class="string">'resize -c 2 252'</span>, smallfov);

<span class="comment">% Direct calibration of the sensitivities from k-space center for SENSE</span>
sensemaps = bart(<span class="string">'caldir 20'</span>, smallfov);

<span class="comment">% SENSE reconstruction</span>
sensereco = bart(<span class="string">'sense -r0.01'</span>, smallfov, sensemaps);

<span class="comment">% ESPIRiT calibration with 2 maps to mitigate with aliasing in the calibration</span>
espiritmaps = bart(<span class="string">'ecalib -r 20 -m 2'</span>, smallfov);

<span class="comment">% ESPIRiT reconstruction with 2 sets of maps</span>
espiritreco = bart(<span class="string">'sense -r0.01'</span>, smallfov, espiritmaps);

<span class="comment">% Combination of the two ESPIRiT images using root of sum of squares</span>
espiritreco_rss = bart(<span class="string">'rss 16'</span>, espiritreco);

espirit_maps = squeeze(espiritmaps);
figure, imshow3(abs(espirit_maps), [],[2,8])
title(<span class="string">'The two sets of ESPIRiT maps'</span>)
</pre><pre class="codeoutput">Calibration region 1x20x20
Done.
Size: 80640 Samples: 27167 Acc: 2.97
Total Time: 0.581754
Calibration region...  (size: 1x20x20, pos: 0x150x116)
Energy: 0.515 0.306 0.115 0.045 0.013 0.004 0.002 0.001
Build calibration matrix and SVD...
Eigen decomposition... (size: 288)
Using 73/288 kernels (25.35%, last SV: 0.034162).
Zeropad...
FFT (juggling)...
Calculate Gram matrix...
Resize...
Point-wise eigen-decomposition...
Crop maps... (0.80)
Fix phase...
Done.
2 maps.
ESPIRiT reconstruction.
Size: 80640 Samples: 27167 Acc: 2.97
Total Time: 0.791920
Warning: Image is too big to fit on screen; displaying at 50% 
</pre><img vspace="5" hspace="5" src="examples_08.png" alt=""> <pre class="codeinput"><span class="comment">% SENSE image:</span>

reco1 = squeeze(sensereco);
figure,
subplot(1,2,1), imshow(abs(reco1), [])
title(<span class="string">'SENSE Reconstruction'</span>)


<span class="comment">% ESPIRiT image:</span>

reco2 = squeeze(espiritreco_rss);
subplot(1,2,2), imshow(abs(reco2), [])
title(<span class="string">'ESPIRiT Reconstruction from 2 maps'</span>)
</pre><img vspace="5" hspace="5" src="examples_09.png" alt=""> <h2>Example 3: Compressed Sensing and Parallel Imaging<a name="18"></a></h2><p>This example demonstrates L1-ESPIRiT reconstruction of a human knee. Data has been acquired with variable-density poisson-disc sampling.</p><pre class="codeinput"><span class="comment">% A visualization of k-space data</span>

knee = readcfl(<span class="string">'data/knee'</span>);
ksp_rss = bart(<span class="string">'rss 8'</span>, knee);

ksp_rss = squeeze(ksp_rss);
figure, imshow(abs(ksp_rss).^0.125, []); title(<span class="string">'k-space'</span>)


<span class="comment">% Root-of-sum-of-squares image</span>

knee_imgs = bart(<span class="string">'fft -i 6'</span>, knee);
knee_rss = bart(<span class="string">'rss 8'</span>, knee_imgs);


<span class="comment">% ESPIRiT calibration (one map)</span>

knee_maps = bart(<span class="string">'ecalib -c0. -m1'</span>, knee);



<span class="comment">% l1-regularized reconstruction (wavelet basis)</span>

knee_l1 = bart(<span class="string">'sense -l1 -r0.005'</span>, knee, knee_maps);



<span class="comment">% Results</span>

knee_rss = knee_rss / 1.5E9;

image = [ squeeze(knee_rss) squeeze(knee_l1) ];
figure, imshow(abs(image), [])
title(<span class="string">'Zero-filled and Compressed Sensing/Parallel Imaging'</span>)
</pre><pre class="codeoutput">Calibration region...  (size: 1x24x24, pos: 0x132x106)
Energy: 0.560 0.266 0.116 0.037 0.010 0.006 0.004 0.001
Build calibration matrix and SVD...
Eigen decomposition... (size: 288)
Using 61/288 kernels (21.18%, last SV: 0.032264).
Zeropad...
FFT (juggling)...
Calculate Gram matrix...
Resize...
Point-wise eigen-decomposition...
Crop maps... (0.00)
Fix phase...
Done.
l1-wavelet regularization
Size: 67968 Samples: 8082 Acc: 8.41
Total Time: 4.134167
</pre><img vspace="5" hspace="5" src="examples_10.png" alt=""> <img vspace="5" hspace="5" src="examples_11.png" alt=""> <h2>Example 4: Basic Tools<a name="21"></a></h2><p>Various tools are demonstrated by manipulating an image.</p><pre class="codeinput"><span class="comment">% Zero pad</span>

knee2 = bart(<span class="string">'resize -c 1 300 2 300'</span>, knee_l1);

<span class="comment">% Switch dimensions 1 and 2</span>

tmp = bart(<span class="string">'transpose 1 2'</span>, knee2);

<span class="comment">% Scale by a factor of 0.5</span>

tmp2 = bart(<span class="string">'scale 0.5'</span>, tmp);

<span class="comment">% Join original and the transposed and scaled version along dimension 2.</span>

joined = bart(<span class="string">'join 2'</span>, knee2, tmp2);

<span class="comment">% Flip 1st and 2nd dimension (2^1 + 2^2 = 6)</span>

tmp = bart(<span class="string">'flip 6'</span>, joined);

<span class="comment">% Join flipped and original along dimension 1.</span>

big = bart(<span class="string">'join 1'</span>, joined, tmp);

<span class="comment">% Extract sub-array</span>

tmp = bart(<span class="string">'extract 1 150 449'</span>, big);
small = bart(<span class="string">'extract 2 150 449'</span>, tmp);

<span class="comment">% Circular shift by 115 pixels</span>

tmp = bart(<span class="string">'circshift 1 150'</span>, small);
shift = bart(<span class="string">'circshift 2 150'</span>, tmp);

<span class="comment">% Show the final result.</span>

figure, imshow(abs(squeeze(shift)), []);

<span class="comment">% end global function</span>
</pre><img vspace="5" hspace="5" src="examples_12.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="http://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2013b</a><br></p></div><!--
##### SOURCE BEGIN #####
function examples

%%
%% ESPIRiT examples (based on work by Sana Vaziri)
%%
% To begin, add '$(TOOLBOX_PATH)/matlab' to the library path. The
% environment variable TOOLBOX_PATH needs to be set to the base
% directory of the reconstruction tools package.

if isempty(getenv('TOOLBOX_PATH'))
	error('Environment variable TOOLBOX_PATH is not set.');	
end

addpath(strcat(getenv('TOOLBOX_PATH'), '/matlab'));



%%
% The input and output datasets are each stored in a pair of files: one 
% header (.hdr) and one raw data (.cfl). All the data files used in this
% demo are in the data folder. The readcfl and writecfl Matlab methods
% can be found in $(TOOLBOX_PATH)/matlab and can be used to view and
% process the data and reconstructed images in Matlab.


%% Example 1: ESPIRiT reconstruction (R = 2x2)
% 
% The example uses ESPIRiT to obtain the image from 2x2 undersampled data.
% 
%%

%%
% A visualization of k-space data and sampling and zero-filled
% reconstruction

% sqrt sum-of-squares of k-space
und2x2 = readcfl('data/und2x2');
ksp_rss = bart('rss 8', und2x2);

% zero-filled reconstruction sqrt-sum-of-squares
zf_coils = bart('fft -i 6', und2x2);
zf_rss = bart('rss 8', zf_coils);

ksp_rss = squeeze(ksp_rss);
zf_coils = squeeze(zf_coils);
zf_rss = squeeze(zf_rss);

figure,subplot(1,2,1), imshow(abs(ksp_rss).^0.125, []); title('k-space')
subplot(1,2,2), imshow(abs(zf_rss), []); title('zero-filled recon')


%%
% Show singular values of the calibration matrix
%
calmat = bart('calmat -r 20 -k 6', und2x2);
[U SV VH] = bart('svd', calmat);

figure, plot(SV);
title('Singular Values of the Calibration Matrix');



%%
% ESPIRiT calibration (using a maximum calibration region of size 20)
[calib emaps] = bart('ecalib -r 20', und2x2);


%%
% Extraction of first set of maps (0-th subarray along dimension 4)
sens = bart('slice 4 0', calib);


sens_maps = squeeze(sens);

figure,
subplot(121), imshow3(abs(sens_maps), [],[2,4]);
title('Magnitude ESPIRiT 1st Set of Maps')
subplot(122), imshow3(angle(sens_maps),[],[2,4])
title('Phase ESPIRiT 1st Set of Maps')




%%
% For comparison: Produce coil images from fully-sampled data
% using the fft command. It uses a bitmask as argument to
% specify the dimensions which are transformed. Here, the
% bitmask is 6 = 2^1 + 2^2 which corresponds to the 
% dimensions 1 and 2.

full = readcfl('data/full');
coilimgs = bart('fft -i 6', full);

coil_imgs = squeeze(coilimgs);
figure, imshow3(abs(coil_imgs), [],[2,4])
title('Coil images')



%%
% Show eigenvalue maps

emaps = squeeze(emaps);
figure, imshow3(emaps, [], [1, 2]);
title('First Two Eigenvalue Maps')




%%
% SENSE reconstruction using ESPIRiT maps
reco = bart('sense', und2x2, sens);

sense_recon = squeeze(reco);
figure, imshow(abs(sense_recon), []); title('ESPIRiT Reconstruction')



%%
% Evaluation of the coil sensitivities.

%
% Computing error from projecting fully sampled error
% onto the sensitivities. This can be done with one
% iteration of POCSENSE.
%
proj = bart('pocsense -r 0. -i 1', full, sens);

% Compute error and transform it into image domain and combine into a single map.
errimgs = bart('fft -i 6', (full - proj));
errsos_espirit = bart('rss 8', errimgs);

%
% For comparison: compute sensitivities directly from the center. 
sens_direct = bart('caldir 20', und2x2);

% Compute error map.
proj = bart('pocsense -r 0. -i 1', full, sens_direct);
errimgs = bart('fft -i 6', (full - proj));
errsos_direct = bart('rss 8', errimgs);


errsos_espirit = squeeze(errsos_espirit);
errsos_direct = squeeze(errsos_direct);

figure, 
imshow(abs([errsos_direct errsos_espirit]), []); title('Projection Error (direct calibration vs ESPIRiT)');
 




%% Example 2: Reconstruction of undersampled data with small FOV.
% 
% This example uses a undersampled data set with a small FOV. The image
% reconstructed using ESPIRiT is compared to an image reconstructed 
% with SENSE. By using two sets of maps, ESPIRiT can avoid the central
% artifact which appears in the SENSE reconstruction.
%
%%

% Zero padding to make square voxels since resolution in x-y for this
% data set is lower in phase-encode than readout
smallfov = readcfl('data/smallfov');
smallfov = bart('resize -c 2 252', smallfov);

% Direct calibration of the sensitivities from k-space center for SENSE
sensemaps = bart('caldir 20', smallfov);

% SENSE reconstruction
sensereco = bart('sense -r0.01', smallfov, sensemaps);

% ESPIRiT calibration with 2 maps to mitigate with aliasing in the calibration
espiritmaps = bart('ecalib -r 20 -m 2', smallfov);

% ESPIRiT reconstruction with 2 sets of maps
espiritreco = bart('sense -r0.01', smallfov, espiritmaps);

% Combination of the two ESPIRiT images using root of sum of squares
espiritreco_rss = bart('rss 16', espiritreco);

espirit_maps = squeeze(espiritmaps);
figure, imshow3(abs(espirit_maps), [],[2,8])
title('The two sets of ESPIRiT maps')
%%

% SENSE image:

reco1 = squeeze(sensereco);
figure,
subplot(1,2,1), imshow(abs(reco1), [])
title('SENSE Reconstruction')


% ESPIRiT image:

reco2 = squeeze(espiritreco_rss);
subplot(1,2,2), imshow(abs(reco2), [])
title('ESPIRiT Reconstruction from 2 maps')




%% Example 3: Compressed Sensing and Parallel Imaging
%
% This example demonstrates L1-ESPIRiT reconstruction of a human knee.
% Data has been acquired with variable-density poisson-disc sampling.
%
%%


% A visualization of k-space data

knee = readcfl('data/knee');
ksp_rss = bart('rss 8', knee);

ksp_rss = squeeze(ksp_rss);
figure, imshow(abs(ksp_rss).^0.125, []); title('k-space')


% Root-of-sum-of-squares image

knee_imgs = bart('fft -i 6', knee);
knee_rss = bart('rss 8', knee_imgs);


% ESPIRiT calibration (one map)

knee_maps = bart('ecalib -c0. -m1', knee);



% l1-regularized reconstruction (wavelet basis)

knee_l1 = bart('sense -l1 -r0.005', knee, knee_maps);



% Results

knee_rss = knee_rss / 1.5E9;

image = [ squeeze(knee_rss) squeeze(knee_l1) ];
figure, imshow(abs(image), [])
title('Zero-filled and Compressed Sensing/Parallel Imaging')
%%




%% Example 4: Basic Tools
%
% Various tools are demonstrated by manipulating an image.
%
%%

% Zero pad

knee2 = bart('resize -c 1 300 2 300', knee_l1);

% Switch dimensions 1 and 2

tmp = bart('transpose 1 2', knee2);

% Scale by a factor of 0.5

tmp2 = bart('scale 0.5', tmp);

% Join original and the transposed and scaled version along dimension 2.

joined = bart('join 2', knee2, tmp2);

% Flip 1st and 2nd dimension (2^1 + 2^2 = 6)

tmp = bart('flip 6', joined);

% Join flipped and original along dimension 1.

big = bart('join 1', joined, tmp);

% Extract sub-array

tmp = bart('extract 1 150 449', big);
small = bart('extract 2 150 449', tmp);

% Circular shift by 115 pixels

tmp = bart('circshift 1 150', small);
shift = bart('circshift 2 150', tmp);

% Show the final result.

figure, imshow(abs(squeeze(shift)), []);

% end global function
end


##### SOURCE END #####
--></body></html>